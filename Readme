# ğŸ“Š Projet IPS Dashboard (FastAPI + PostgreSQL + Dash)

Ce projet permet de :
- Stocker des donnÃ©es dâ€™Ã©coles avec leur **Indice de Position Sociale (IPS)** dans une base PostgreSQL.
- Fournir une API REST sÃ©curisÃ©e via **FastAPI**.
- Visualiser  les donnÃ©es dans un **Dashboard Dash**.

---

## ğŸš€ FonctionnalitÃ©s

### ğŸ” API FastAPI
- Authentification par **JWT** (compte admin: `admin` / `1234`).
- Endpoints :
  - `POST /login` â€“ RÃ©cupÃ©ration du token JWT.
  - `GET /schools` â€“ Liste des Ã©coles (avec filtres acadÃ©mie, commune, etc.).
  - `GET /schools/{uai}` â€“ DÃ©tails d'une Ã©cole.
  - `GET /schools/ips?min_ips=&max_ips=` â€“ Ã‰coles filtrÃ©es par plage IPS.
  - `DELETE /schools/{uai}` â€“ Supprime une Ã©cole (authentifiÃ© uniquement).

### ğŸ“ˆ Dashboard Dash
- Graphique dynamique de lâ€™**IPS moyen par dÃ©partement**.
- Graphique des **Ã©coles par tranche dâ€™IPS (5 en 5 entre 80 et 115)**.
- DonnÃ©es chargÃ©es dynamiquement depuis lâ€™API (aucune connexion directe Ã  la base).

---

## ğŸ› ï¸ Structure

\`\`\`
project-root/
â”‚
â”œâ”€â”€ app/                            # Code de lâ€™API FastAPI
â”‚   â”œâ”€â”€ main.py                     # Point d'entrÃ©e de l'application FastAPI
â”‚   â”œâ”€â”€ requirements.txt            # DÃ©pendances Python backend
â”‚   â”œâ”€â”€ entrypoint.sh               # Script shell : init DB + lancement API
â”‚   â”‚â”€â”€ dependencies.py 
â”‚   â”‚â”€â”€ auth.py   
â”‚   â”‚
â”‚   â”œâ”€â”€ bdd/                        # Gestion de la base de donnÃ©es
â”‚   â”‚   â”œâ”€â”€ database.py             # Configuration SQLAlchemy (engine, session, Base)
â”‚   â”‚   â”œâ”€â”€ models.py               # ModÃ¨les SQLAlchemy (School, User)
â”‚   â”‚   â”œâ”€â”€ init_db.py              # CrÃ©ation des tables
â”‚   â”‚   â”œâ”€â”€ load_ips.py             # Chargement des donnÃ©es + crÃ©ation admin
â”‚   â”‚   â””â”€â”€ ips.csv                 # DonnÃ©es IPS des Ã©coles (source CSV)
â”‚   â”‚
â”‚   â””â”€â”€ routers/                    # Routes de lâ€™API
â”‚       â”œâ”€â”€ schools.py              # Routes GET sur les Ã©coles et lâ€™IPS
â”‚       â”œâ”€â”€ auth.py                 # Route POST /login (authentification JWT)
â”‚            # VÃ©rification du token JWT
â”‚
â”œâ”€â”€ dashboard/                      # Code du dashboard Dash
â”‚   â”œâ”€â”€ app.py                      # Interface graphique : graphiques IPS
â”‚   â”œâ”€â”€ requirements.txt            # DÃ©pendances Python pour Dash
â”‚   â””â”€â”€ Dockerfile                  # Image Docker du dashboard
â”‚
â”œâ”€â”€ .env                            # Variables dâ€™environnement (.env)
â”œâ”€â”€ docker-compose.yml              # Configuration des services (FastAPI + PostgreSQL + Dash)
â””â”€â”€ Dockerfile                      # Image Docker du backend (FastAPI)

\`\`\`

---

## ğŸ³ Lancer le projet avec Docker

\`\`\`bash
# 1. Construire et lancer tous les services (FastAPI, PostgreSQL, Dashboard)
docker-compose up --build
\`\`\`

Ensuite :

- AccÃ¨s API : http://localhost:8000/docs
- AccÃ¨s Dashboard : http://localhost:8050

---

## ğŸ“¦ Variables `.env`

\`\`\`env
DATABASE_URL=postgresql://user:password@db:5432/ipsdb
SECRET_KEY=devsecretkey
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
IPS_FILE=bdd/ips.csv
\`\`\`

---

## ğŸ” Authentification

\`\`\`bash
POST /login
{
  "username": "admin",
  "password": "1234"
}
\`\`\`

Utilise ensuite le `access_token` dans Swagger via le bouton **Authorize** en haut Ã  droite :  
\`\`\`
<votre_token>
\`\`\`

---

