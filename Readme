
# ğŸ“Š Projet IPS Dashboard (FastAPI + PostgreSQL + Dash)

Ce projet permet de :

- Stocker des donnÃ©es dâ€™Ã©coles avec leur **Indice de Position Sociale (IPS)** dans une base **PostgreSQL**.
- Fournir une API REST sÃ©curisÃ©e via **FastAPI** (authentification JWT).
- Visualiser les donnÃ©es dans un **Dashboard  Dash**.

---

## ğŸš€ FonctionnalitÃ©s

### ğŸ” API FastAPI

- Authentification par **JWT** (`admin` / `1234`).
- Endpoints :
  - `POST /login` â†’ RÃ©cupÃ©ration du token JWT.
  - `GET /schools` â†’ Liste complÃ¨te des Ã©coles.
  - `GET /schools/{uai}` â†’ DÃ©tails dâ€™une Ã©cole par UAI.
  - `GET /schools/ips?min_ips=&max_ips=` â†’ Filtrage des Ã©coles selon lâ€™IPS.
  - `DELETE /schools/{uai}` â†’ Supprimer une Ã©cole (JWT requis).

### ğŸ“ˆ Dashboard Dash

- Graphique dynamique de lâ€™**IPS moyen par dÃ©partement**.
- Graphique des **Ã©coles par tranche dâ€™IPS (par pas de 5 entre 80 et 115)**.
- DonnÃ©es chargÃ©es via lâ€™API (pas d'accÃ¨s direct Ã  la base).

---

## ğŸ—‚ï¸ Architecture du projet

```
project-root/
â”‚
â”œâ”€â”€ app/                            # Code backend FastAPI
â”‚   â”œâ”€â”€ main.py                     # EntrÃ©e principale de lâ€™API
â”‚   â”œâ”€â”€ entrypoint.sh               # Script Docker : init DB + lancement FastAPI
â”‚   â”œâ”€â”€ requirements.txt            # DÃ©pendances Python (API)
â”‚   â”œâ”€â”€ auth.py                     # Fonctions de hash / JWT
â”‚   â”œâ”€â”€ dependencies.py             # VÃ©rification JWT
â”‚   â”œâ”€â”€ schemas.py                  # SchÃ©mas Pydantic de rÃ©ponse
â”‚   â”œâ”€â”€ tests/                      # Tests unitaires de lâ€™API
â”‚   â”‚   â””â”€â”€ test_main.py
â”‚   â”œâ”€â”€ bdd/
â”‚   â”‚   â”œâ”€â”€ database.py             # SQLAlchemy Base + Session
â”‚   â”‚   â”œâ”€â”€ models.py               # Tables User et School
â”‚   â”‚   â”œâ”€â”€ init_db.py              # CrÃ©ation des tables
â”‚   â”‚   â”œâ”€â”€ load_ips.py             # Import CSV + crÃ©ation admin
â”‚   â”‚   â””â”€â”€ ips.csv                 # DonnÃ©es dâ€™Ã©coles
â”‚   â””â”€â”€ routers/
â”‚       â”œâ”€â”€ schools.py              # Routes /schools
â”‚       â””â”€â”€ auth.py                 # Route /login
â”‚
â”œâ”€â”€ dashboard/                      # Code du dashboard Dash
â”‚   â”œâ”€â”€ app.py                      # App Dash (visualisation)
â”‚   â”œâ”€â”€ requirements.txt            # DÃ©pendances Dash
â”‚   â””â”€â”€ Dockerfile                  # Image du dashboard
â”‚
â”œâ”€â”€ .env                            # Configuration dâ€™environnement
â”œâ”€â”€ Dockerfile                      # Dockerfile backend
â”œâ”€â”€ docker-compose.yml              # DÃ©ploiement multi-services
```

---

## ğŸ³ Lancement du projet

```bash
docker-compose up --build
```

AccÃ¨s aux services :

- ğŸ”— API : http://localhost:8000/docs
- ğŸ“Š Dashboard : http://localhost:8050

---

## ğŸ” Authentification

```http
POST /login
{
  "username": "admin",
  "password": "1234"
}
```

Dans Swagger (`/docs`), cliquez sur **Authorize**, puis collez le token JWT dans ce format :

```
Bearer <votre_token>
```

---

## âœ… Tests unitaires

Les tests de lâ€™API sont dÃ©finis dans `app/tests/test_main.py` et sont lancÃ©s automatiquement au dÃ©marrage.

```bash
# Pour relancer manuellement :
docker exec -it fastapi_app pytest
```

Les tests vÃ©rifient :

- AccÃ¨s aux Ã©coles (`/schools`)
- Filtrage IPS
- Authentification JWT (valide et invalide)

---

## ğŸ“ Exemple dâ€™utilisation

- Affichez les Ã©coles dont lâ€™IPS est compris entre 90 et 100 :
  ```
  GET /schools/ips?min_ips=90&max_ips=100
  ```

- Supprimez une Ã©cole :
  ```
  DELETE /schools/0931234A (avec token JWT)
  ```

---

